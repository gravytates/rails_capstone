// PATH GENERATOR
// var path = d3.geo.path();
dataset = []
var loadData = function(){
  $.ajax({
    type: 'GET',
    contentType: 'application/json; charset=utf-8',
    url: '/parks',
    dataType: 'json',
    success: function(data){
      console.log(data);
      dataset.push(data);
      runStuff(data);
    },
    failure: function(result){
      error();
    }
  });
};

// Coordinates for one park
test_park = [[-122.71548621138173, 45.48695588591833], [-122.71548933123073, 45.487023389836864], [-122.71476649015926, 45.48701744279941], [-122.7136826745656, 45.48700747648776], [-122.71291396731236, 45.48700068742902], [-122.71291282555364, 45.48660835590457], [-122.71291230542909, 45.48648232525971], [-122.71291145023292, 45.486034770474106], [-122.71244905501685, 45.486030477170594], [-122.71194226955099, 45.4860256655465], [-122.7115486457598, 45.48602193023958], [-122.71154795226039, 45.48571601777747], [-122.71174012884914, 45.48571780262275], [-122.71174136493096, 45.48564935748115], [-122.71174259292795, 45.48558074095109], [-122.7117423369081, 45.48536124747807], [-122.71177124649057, 45.485177031589664], [-122.71188829697212, 45.48517786355975], [-122.71222920313085, 45.48518021209593], [-122.71257059617649, 45.48518255055523], [-122.71291150233522, 45.48518489846145], [-122.71310663348292, 45.48518748254376], [-122.7134861555208, 45.48519234210448], [-122.71350176644378, 45.485192554977914], [-122.71386031192145, 45.48519713175666], [-122.71422276237567, 45.485201803005474], [-122.71457399377027, 45.48520634766348], [-122.71491303143326, 45.48521078210564], [-122.71538573212226, 45.4852169239429], [-122.71538973950676, 45.48588237405877], [-122.71539279198208, 45.485923128101696], [-122.71540167721857, 45.485963426773836], [-122.71541686234012, 45.486002747347015], [-122.7154373600983, 45.48604076422002], [-122.71546363851527, 45.48607695466717], [-122.71548708544252, 45.48610308163136], [-122.71548667042086, 45.486505046770105], [-122.71548621138173, 45.48695588591833]]

var w = 800;
var h = 500;
//Define path generator, using the Albers USA projection

  var path = d3.geoPath()
         .projection(d3.geoAlbersUsa());
  //Create SVG element
  var svg = d3.select("body")
        .append("svg")
        .attr("width", w)
        .attr("height", h);
  //Load in GeoJSON data

function error() {
    console.log("Something went wrong!");
}


// fetch data on page load
$(document).ready(function(){
  console.log('load?');
  loadData();
  d3.json(test_park, function(json) {
    //Bind data and create one path per GeoJSON feature
    svg.selectAll("path")
       .dataset(json.features)
       .enter()
       .append("path")
       .attr("d", path);
  });
});
